version: '3.3'
services:

  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:$ELASTIC_VERSION
    container_name: elasticsearch
    environment:
      ES_JAVA_OPTS: '-Xms2048m -Xmx2048m'
      network.bind_host: 0.0.0.0    
      bootstrap.memory_lock: 'true'
      discovery.type: 'single-node'
      ELASTIC_PASSWORD: $ELASTIC_PASSWORD
      xpack.security.enabled: $ELASTIC_SECURITY
    ports:
      - 9200:9200
      - 9300:9300
    ulimits:
      memlock:
        soft: -1
        hard: -1      
    networks: 
      - elk

  kibana:
    image: docker.elastic.co/kibana/kibana:$KIBABA_VERSION
    container_name: kibana
    environment:
      ELASTICSEARCH_USERNAME: $ELASTIC_PASSWORD
      ELASTICSEARCH_PASSWORD: $ELASTIC_PASSWORD
      ELASTICSEARCH_URL: "http://elasticsearch:9200" 
    ports: 
      - 5601:5601
    logging:
      driver: gelf
      options:
        gelf-address: "udp://localhost:12201"
        tag: "demo_kibana"      
    networks: 
      - elk
    depends_on: 
      - elasticsearch

  logstash:
    image: docker.elastic.co/logstash/logstash:$LOGSTASH_VERSION
    container_name: logstash
    ports:
      - 5044:5044
      - 5001:5001
      - 12201:12201/udp
    environment:
      ES_JAVA_OPTS: -Xmx2048m -Xms2048m"
      http.host: 0.0.0.0
      xpack.monitoring.enabled: 'false'
      xpack.monitoring.elasticsearch.url: http://elasticsearch:9200
    volumes:
      - .:/etc/logstash
    command: logstash -f /etc/logstash/logstash.conf
    networks: 
      - elk
    depends_on:
      - elasticsearch

networks:
  elk:
      driver: bridge